# lab1:
# 1:ä¿®æ”¹é¡è‰²
# 2:ä¿®æ”¹terminalåç¨± linux@virtualBox => linux@virtualBox-P77131142
# 3:ä¿®æ”¹ç¬¦è™Ÿ linux@virtualBox-P77131142:~$ => linux@virtualBox-P77131142:~#

# é–‹å•Ÿè¨­å®šæª”
nano ~/.bashrc
# ä¿®æ”¹éœ€æ±‚ \e[1;35m=é–‹å§‹äº®ç²‰è‰²  \[\e[0m\]é‡ç½®é¡è‰²
PS1='\[\e[1;35m\]\u@\h-P77131142\[\e[0m\]:\w# '


#lab2:

cd /path/to/Linux_Week5_Miniproject1   # æ ¹ç›®éŒ„ï¼ˆscript è¦æ”¾åœ¨é€™è£¡ï¼‰
ls
# æ‡‰çœ‹åˆ° compressed_files/ å’Œ student_id



#inux_Week5_Miniproject1/template.sh:

#!/usr/bin/env bash
# â†‘ æŒ‡å®šä½¿ç”¨ bash é€™å€‹ shell ä¾†åŸ·è¡Œè…³æœ¬ï¼ˆä¸è«–ç³»çµ±å®‰è£è·¯å¾‘åœ¨å“ªï¼Œç”¨ env å¹«ä½ æ‰¾åˆ°ï¼‰

set -euo pipefail
# -e ï¼šåªè¦æœ‰ä»»ä½•ä¸€è¡ŒæŒ‡ä»¤å‡ºéŒ¯ï¼ˆå›å‚³é 0 ç‹€æ…‹ç¢¼ï¼‰ï¼Œæ•´å€‹è…³æœ¬ç«‹å³åœæ­¢
# -u ï¼šå¦‚æœç”¨åˆ°æœªå®£å‘Šçš„è®Šæ•¸ï¼Œç«‹åˆ»å ±éŒ¯åœæ­¢ï¼ˆé˜²æ­¢æ‰“éŒ¯è®Šæ•¸åï¼‰
# -o pipefail ï¼šç•¶ç®¡ç·šæŒ‡ä»¤ï¼ˆa | b | cï¼‰ä¸­æœ‰ä»»ä¸€å¤±æ•—æ™‚ï¼Œæ•´æ¢å‘½ä»¤ç®—å¤±æ•—
# ğŸ‘‰ é€™ä¸‰å€‹ä¸€èµ·é–‹å•Ÿè¢«ç¨±ç‚ºã€Œåš´æ ¼æ¨¡å¼ã€ï¼Œèƒ½é˜²æ­¢è…³æœ¬éœéœéŒ¯æ‰å»æ²’ç™¼ç¾

shopt -s nullglob
# nullglobï¼šç•¶ä½ ç”¨ *.zip é€™ç¨®è¬ç”¨å­—å…ƒæ‰¾æª”æ¡ˆæ™‚ï¼Œ
# å¦‚æœæ²’æœ‰ç¬¦åˆçš„æª”æ¡ˆï¼Œä¸æœƒå‚³å›å­—ä¸² "*.zip"ï¼Œ
# è€Œæ˜¯ç›´æ¥è¦–ç‚ºã€Œæ²’æœ‰çµæœã€ï¼Œé¿å…èª¤åˆ¤ã€‚

# -----------------------------------------------------------
# å–å¾—è…³æœ¬æ‰€åœ¨çš„ç›®éŒ„ï¼Œä¸¦åˆ‡æ›åˆ°é‚£è£¡
ROOT_DIR="$(cd "$(dirname "$0")" && pwd)"
# $(dirname "$0") ï¼šå–å¾—ç›®å‰è…³æœ¬æª”æ¡ˆçš„æ‰€åœ¨è³‡æ–™å¤¾
# cd "$(dirname "$0")" ï¼šåˆ‡æ›åˆ°é‚£å€‹è³‡æ–™å¤¾
# pwd ï¼šè¼¸å‡ºç›®å‰è·¯å¾‘ï¼ˆprint working directoryï¼‰
# æ‰€ä»¥æ•´å€‹æ„æ€æ˜¯ï¼šã€Œæ‰¾åˆ°è…³æœ¬æœ¬èº«æ‰€åœ¨çš„è³‡æ–™å¤¾çµ•å°è·¯å¾‘ã€
cd "$ROOT_DIR"
# åˆ‡æ›åˆ°è…³æœ¬æ‰€åœ¨è³‡æ–™å¤¾ï¼Œç¢ºä¿æ‰€æœ‰è·¯å¾‘æ“ä½œéƒ½æ˜¯ç›¸å°æ–¼è…³æœ¬ç›®éŒ„

# -----------------------------------------------------------
# å»ºç«‹è¼¸å‡ºç›®éŒ„èˆ‡æ¸…å–®æª”
mkdir -p zip rar "tar.gz" unknown uncompressed
# -p åƒæ•¸ï¼šå¦‚æœè³‡æ–™å¤¾ä¸å­˜åœ¨å°±å»ºç«‹ï¼›å­˜åœ¨å‰‡ç•¥é
# ä¸Šé¢å»ºç«‹äº”å€‹è³‡æ–™å¤¾ç”¨ä¾†æ”¾ä¸åŒé¡å‹çš„å£“ç¸®æª”èˆ‡è§£å£“å¾Œçš„æª”æ¡ˆ

: > missing_list
: > wrong_list
# ã€Œ:ã€ æ˜¯ bash çš„ç©ºæŒ‡ä»¤ï¼ˆä¸åšäº‹ä½†å›å‚³æˆåŠŸï¼‰
# ã€Œ: > æª”åã€ è¡¨ç¤ºæ¸…ç©ºæª”æ¡ˆå…§å®¹æˆ–å»ºç«‹ä¸€å€‹æ–°çš„ç©ºç™½æª”æ¡ˆ
# é€™è£¡å»ºç«‹ / æ¸…ç©ºã€Œç¼ºäº¤åå–®ã€èˆ‡ã€Œæ ¼å¼éŒ¯èª¤åå–®ã€

# -----------------------------------------------------------
# [ç¬¬1æ­¥] åˆ†é¡å£“ç¸®æª”æ¡ˆ
# ä¾†æºè³‡æ–™å¤¾ç‚º compressed_files/

if [[ ! -d compressed_files ]]; then
  echo "Error: compressed_files/ not found in $ROOT_DIR" >&2
  # >&2 è¡¨ç¤ºæŠŠéŒ¯èª¤è¨Šæ¯è¼¸å‡ºåˆ°éŒ¯èª¤è¼¸å‡ºç®¡é“ï¼ˆstderrï¼‰
  exit 1
  # çµæŸè…³æœ¬ä¸¦å›å‚³éŒ¯èª¤ç¢¼ 1
fi

echo "Classifying files..."
for f in compressed_files/*; do
  [[ -f "$f" ]] || continue
  # æª¢æŸ¥ f æ˜¯å¦æ˜¯ä¸€èˆ¬æª”æ¡ˆï¼Œä¸æ˜¯å°±è·³éï¼ˆä¾‹å¦‚è³‡æ–™å¤¾ï¼‰
  fname=$(basename "$f")
  # å–å¾—ç´”æª”åï¼ˆå»æ‰å‰é¢çš„è·¯å¾‘ï¼‰
  case "$fname" in
    *.zip)        mv -n -- "$f" zip/ ;;        # å‰¯æª”åæ˜¯ .zip â†’ ç§»åˆ° zip/
    *.tar.gz|*.tgz) mv -n -- "$f" "tar.gz"/ ;; # å‰¯æª”åæ˜¯ .tar.gz æˆ– .tgz â†’ ç§»åˆ° tar.gz/
    *.rar)        mv -n -- "$f" rar/ ;;        # å‰¯æª”åæ˜¯ .rar â†’ ç§»åˆ° rar/
    *)            mv -n -- "$f" unknown/ ;;    # å…¶ä»– â†’ ç§»åˆ° unknown/
  esac
done
# -n ï¼šè‹¥ç›®æ¨™å·²å­˜åœ¨ç›¸åŒæª”åï¼Œä¸æœƒè¦†è“‹
# -- ï¼šé˜²æ­¢æª”åä»¥ã€Œ-ã€é–‹é ­æ™‚è¢«èª¤èªç‚ºé¸é …

# -----------------------------------------------------------
# [ç¬¬2æ­¥] æª¢æŸ¥ student_id æ¸…å–®ï¼Œæ‰¾å‡ºæ²’äº¤æˆ–æ ¼å¼éŒ¯èª¤è€…
if [[ ! -f student_id ]]; then
  echo "Warning: student_id file not found; skipping missing/wrong check."
else
  echo "Checking student_id list..."
  while IFS= read -r id || [[ -n "$id" ]]; do
    # IFS= ï¼šé¿å…è®€å…¥è¡Œæ™‚è‡ªå‹•ä¾ç©ºç™½åˆ‡å‰²
    # -r ï¼šä¸è®“åæ–œç·šè½‰ç¾©å­—å…ƒç”Ÿæ•ˆ
    # é€™è¡Œæ„æ€ï¼šé€è¡Œè®€å– student_id æª”æ¡ˆä¸­çš„æ¯å€‹å­¸è™Ÿ

    # æ¸…ç†å­¸è™Ÿä¸­çš„æ›è¡Œèˆ‡ç©ºç™½
    id=$(echo "$id" | tr -d '\r\n' | xargs)
    [[ -z "$id" ]] && continue
    # è‹¥è¡Œæ˜¯ç©ºçš„å°±è·³é

    found=0
    # é è¨­å‡è¨­æ­¤å­¸è™Ÿæ²’æ‰¾åˆ°äº¤ä»¶

    # åœ¨å››å€‹è³‡æ–™å¤¾ä¸­å°‹æ‰¾æ˜¯å¦æœ‰ä»¥å­¸è™Ÿé–‹é ­çš„æª”æ¡ˆ
    for dir in zip "tar.gz" rar unknown; do
      if compgen -G "$dir/${id}*" > /dev/null; then
        # compgen -G æ˜¯æ¯” ls æ›´å®‰å…¨çš„æ–¹å¼ä¾†åˆ¤æ–·é€šé…ç¬¦æ˜¯å¦æœ‰åŒ¹é…
        # è‹¥æœ‰æ‰¾åˆ°åŒ¹é…æª”æ¡ˆï¼Œè¡¨ç¤ºè©²å­¸ç”Ÿæœ‰äº¤ä»¶
        found=1
        if [[ "$dir" == "unknown" ]]; then
          # å¦‚æœä»–çš„æª”æ¡ˆæ˜¯åœ¨ unknown è³‡æ–™å¤¾ â†’ æ ¼å¼ä¸å°
          echo "$id" >> wrong_list
        fi
      fi
    done

    if [[ $found -eq 0 ]]; then
      # æ²’åœ¨ä»»ä½•è³‡æ–™å¤¾æ‰¾åˆ° â†’ æ²’äº¤ä½œæ¥­
      echo "$id" >> missing_list
    fi
  done < student_id
fi

# -----------------------------------------------------------
# [ç¬¬3æ­¥] è§£å£“ç¸® zip é¡å‹æª”æ¡ˆ
echo "Uncompressing zip files..."
for f in zip/*.zip; do
  [[ -e "$f" ]] || continue
  base=$(basename "$f")        # å–å‡ºç´”æª”å
  id=${base%%.*}               # å¾æª”åä¸­å–å‡ºå­¸è™Ÿï¼ˆåˆªæ‰ç¬¬ä¸€å€‹ '.' ä¹‹å¾Œçš„éƒ¨åˆ†ï¼‰
  target="uncompressed/$id"    # è¨­å®šè§£å£“ç›®æ¨™è·¯å¾‘
  mkdir -p "$target"           # è‹¥è©²è³‡æ–™å¤¾ä¸å­˜åœ¨å‰‡å»ºç«‹
  unzip -q "$f" -d "$target" || echo "unzip failed: $f" >&2
  # -q å®‰éœæ¨¡å¼ï¼›-d æŒ‡å®šè§£å£“ç›®çš„è³‡æ–™å¤¾
  # è‹¥ unzip å¤±æ•—ï¼Œè¼¸å‡ºéŒ¯èª¤è¨Šæ¯åˆ° stderr
done

# -----------------------------------------------------------
# [ç¬¬4æ­¥] è§£å£“ç¸® tar.gz æª”æ¡ˆ
echo "Uncompressing tar.gz files..."
for f in "tar.gz"/*.tar.gz "tar.gz"/*.tgz; do
  [[ -e "$f" ]] || continue
  base=$(basename "$f")
  id=${base%%.*}
  target="uncompressed/$id"
  mkdir -p "$target"
  tar -xzf "$f" -C "$target" || echo "tar failed: $f" >&2
  # -x è§£å£“ï¼›-z ä»£è¡¨ gzipï¼›-f æŒ‡å®šæª”æ¡ˆï¼›-C æŒ‡å®šè§£å£“ç›®çš„è³‡æ–™å¤¾
done

# -----------------------------------------------------------
# [ç¬¬5æ­¥] è§£å£“ç¸® rar æª”æ¡ˆ
echo "Uncompressing rar files..."
for f in rar/*.rar; do
  [[ -e "$f" ]] || continue
  base=$(basename "$f")
  id=${base%%.*}
  target="uncompressed/$id"
  mkdir -p "$target"
  unrar x -inul "$f" "$target" || echo "unrar failed: $f" >&2
  # unrar x ï¼šè§£å£“ä¸¦å»ºç«‹ç›®éŒ„
  # -inul ï¼šéœé»˜æ¨¡å¼ï¼ˆä¸é¡¯ç¤ºè¼¸å‡ºï¼‰
done

# -----------------------------------------------------------
echo "Done. Check missing_list, wrong_list, and uncompressed/ directory."
# æœ€å¾Œé¡¯ç¤ºæç¤ºè¨Šæ¯ï¼Œå‘Šè¨´ä½ çµæœå¯ä»¥åœ¨å“ªäº›æª”æ¡ˆ/è³‡æ–™å¤¾æŸ¥çœ‹
